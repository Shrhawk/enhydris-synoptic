sudo: false

language: python

python:
 - "3.4"
 - "3.5"
 - "3.6"

addons:
  postgresql: "9.5"
  apt:
    packages:
      - libgdal1h
      - gdal-bin
      - libgdal-dev
      - python3-psycopg2
      - postgresql-9.5-postgis-2.3

install:
 - CPLUS_INCLUDE_PATH=/usr/include/gdal C_INCLUDE_PATH=/usr/include/gdal pip install 'gdal<1.11'
 - pip install codecov
 - pip install psycopg2==2.7.4
 - pip install -r requirements.txt
 - pip install -r requirements-dev.txt
 - git clone https://github.com/openmeteo/enhydris.git ../enhydris
 - pip install -r ../enhydris/requirements.txt
 - pip install -r ../enhydris/requirements-test.txt

before_script:
 - psql -U postgres -c "create extension postgis"
 - cp .travis-settings.py ../enhydris/enhydris/settings/local.py
 - cd ../enhydris
 - ln -s ../enhydris-synoptic/enhydris_synoptic .
 - mkdir /tmp/enhydris-synoptic-root

script:
 - coverage run --include="./*" --omit="*/tests/*","*/tests.py" ./manage.py test -v2 enhydris_synoptic

after_success:
 - codecov
